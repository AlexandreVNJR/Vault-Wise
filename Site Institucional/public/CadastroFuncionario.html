<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Vault Wise - Crie sua conta</title>
    <link rel="stylesheet" href="css/styleCadastroFuncionario.css">
</head>
<body>
  <header>
    <div class="logo"><img src="css/imagens/logosemfundo.png" alt=""></div>
    <div class="logo">VaultWise</div>
    <nav>
        <ul id="link_nav">
            <li><a href="index.html">Home</a></li>
            <li><a href="index.html#sobre_nos">Sobre</a></li>
            <li><a href="#">Cadastro</a></li>
            <li class="btn_login"><a href="Login.html">Login</a></li>
        </ul>
    </nav>
    <button class="hamburguer" onclick="ativarMenu()">&#9776;</button>
</header>
    <div class="container">
        <div class="form-container">
            <h1>Olá! Seja bem-vindo!</h1>
            <h2>Crie sua conta<span style="color: #982727;">.</span></h2>
            <p>já possui conta?<a href="#"><span style="color: #F7B6B9  ;"> Login</span></a></p>
            <form>
                <div class="inputs1">
                    <input type="text" placeholder="Nome" class="input_nome">
                    <input type="text" placeholder="CPF" class="input_cpf">
                </div>
                <div class="inputs2">
                    <input type="text" placeholder="Email" class="input_email">
                    <input type="text" placeholder="Telefone" class="input_tel">
                </div>
                <div class="inputs3">
                    <input type="text" placeholder="Empresa" class="input_empresa">
                    <input type="text" placeholder="Cargo" class="input_cargo">
                </div>
                <input type="password" placeholder="Senha" class="input_senha">
                <div class="buttons">
                    <button onclick="cadastrar()" type="submit" class="btn-primary">Criar Conta</button>
                    <button onclick="mudarCadastro()" href="CadastroEmpresa.html" type="button" class="btn-secondary">Mudar Cadastro</button>
                </div>
            </form>
        </div>
    </div>
</body>
</html>

<script>

    // Array para armazenar empresas cadastradas para validação de código de ativação 
    // let listaEmpresasCadastradas = [];
      function ativarMenu() {
        var linknav = document.getElementById("link_nav")
        linknav.classList.toggle("ativo")
      }

      function mudarCadastro() {
        window.location.href="CadastroEmpresa.html"
      }

      function cadastrar() {
        // aguardar();
    
        //Recupere o valor da nova input pelo nome do id
        // Agora vá para o método fetch logo abaixo
        var nome = document.getElementById("input_nome");
        var cpf = document.getElementById("input_cpf");
        var email = document.getElementById("input_email");
        var telefone = document.getElementById("input_telefone");
        var cargo = document.getElementById("input_cargo");
        var empresa = document.getElementById("input_empresa");
        var senha = document.getElementById("input_senha");
        // Verificando se há algum campo em branco
        if (

          nome == "" ||
          cpf == "" ||
          email == "" ||
          telefone == "" ||
          cargo == "" ||
          empresa == "" ||
          senha == "" 
        ) {
          cardErro.style.display = "block";
          mensagem_erro.innerHTML =
            "(Mensagem de erro para todos os campos em branco)";
    
          // finalizarAguardar();
          return false;
        }
        // else {
        //   setInterval(sumirMensagem, 5000);
        // }
    
        // Verificando se o código de ativação é de alguma empresa cadastrada
      //   for (let i = 0; i < listaEmpresasCadastradas.length; i++) {
      //     if (listaEmpresasCadastradas[i].codigo_ativacao == codigoVar) {
      //       idEmpresaVincular = listaEmpresasCadastradas[i].id
      //       console.log("Código de ativação válido.");
      //       break;
      //     } else {
      //       cardErro.style.display = "block";
      //       mensagem_erro.innerHTML = "(Mensagem de erro para código inválido)";
      //       finalizarAguardar();
      //     }
      //   }
    
        // Enviando o valor da nova input
        fetch("/usuarios/cadastrar", {
          method: "POST",
          headers: {
            "Content-Type": "application/json",
          },
          body: JSON.stringify({
            // crie um atributo que recebe o valor recuperado aqui
            // Agora vá para o arquivo routes/usuario.js
              nomeServer: nome,
              cpfServer: cpf,
              emailServer: email,
              telefoneServer: telefone,
              empresaServer: empresa,
              cargoServer: cargo,
              senhaServer: senha,

          }),
        })
          .then(function (resposta) {
            console.log("resposta: ", resposta);
    
            if (resposta.ok) {
              cardErro.style.display = "block";
    
              mensagem_erro.innerHTML =
                "Cadastro realizado com sucesso! Redirecionando para tela de Login...";
    
              setTimeout(() => {
                window.location = "login.html";
              }, "2000");
    
              limparFormulario();
              // finalizarAguardar();
            } else {
              throw "Houve um erro ao tentar realizar o cadastro!";
            }
          })
          .catch(function (resposta) {
            console.log(`#ERRO: ${resposta}`);
            // finalizarAguardar();
          });
    
        return false;
      }
    
    // Listando empresas cadastradas 
    // function listar() {
    //   fetch("/empresas/listar", {
    //     method: "GET",
    //   })
    //     .then(function (resposta) {
    //       resposta.json().then((empresas) => {
    //         empresas.forEach((empresa) => {
    //           listaEmpresasCadastradas.push(empresa);
  
    //           console.log("listaEmpresasCadastradas")
    //           console.log(listaEmpresasCadastradas[0].codigo_ativacao)
    //         });
    //       });
    //     })
    //     .catch(function (resposta) {
    //       console.log(`#ERRO: ${resposta}`);
    //     });
    // }
  
    // function sumirMensagem() {
    //   cardErro.style.display = "none";
    // }
  </script>
